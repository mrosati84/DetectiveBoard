{% extends 'base.html' %}

{% block title %}DetectiveBoard{% endblock %}

{% block content %}
<!-- Auth header -->
<header id="auth-header">
    <div id="auth-logo">&#128269; DetectiveBoard</div>
    <div id="auth-controls">
        <div id="auth-logged-out">
            <button class="auth-btn" onclick="openRegisterModal()">Sign up</button>
            <button class="auth-btn auth-btn-primary" onclick="openLoginModal()">Log in</button>
        </div>
        <div id="auth-logged-in" style="display:none;">
            <span id="auth-email"></span>
            <button class="auth-btn" onclick="logout()">Log out</button>
        </div>
    </div>
</header>

<!-- Cork board -->
<div id="board">
    <div id="canvas">
        <svg id="connections-svg" xmlns="http://www.w3.org/2000/svg"></svg>
    </div>
    <div id="no-board-msg">
        <p id="no-board-text">Open the menu to load or create a board</p>
    </div>
</div>

<!-- Reset pan button (top-right, visible only when panned) -->
<button id="reset-pan-btn" onclick="resetPan()" title="Reset pan" style="display:none;">&#8982; Reset Pan</button>

<!-- Menu toggle (hidden until logged in) -->
<button id="menu-toggle" onclick="toggleMenu()" title="Toggle boards menu" style="display:none;">&#9776; Boards</button>

<!-- Left slide-in menu -->
<div id="menu">
    <h2>Boards</h2>
    <form id="new-board-form">
        <input type="text" id="new-board-name" placeholder="Board name..." maxlength="100" autocomplete="off">
        <button type="submit" id="create-board-btn" title="Create board">+</button>
    </form>
    <div id="boards-list"></div>
</div>

<!-- Bottom toolbar -->
<div id="toolbar" style="display:none;">
    <button id="add-card-btn" class="toolbar-btn" onclick="openModal()">+ Card</button>
    <button id="add-note-btn" class="toolbar-btn" onclick="openNoteModal()">&#128203; Note</button>
    <button id="connect-btn" class="toolbar-btn" onclick="connectCards()">&#128279; Connect</button>
    <button id="disconnect-btn" class="toolbar-btn" onclick="disconnectCards()">&#9986; Disconnect</button>
</div>

<!-- Card edit panel (right side) -->
<div id="edit-panel">
    <div id="edit-panel-header">
        <h2>Edit Card</h2>
        <button id="edit-panel-close" onclick="closeEditPanel()" title="Close">&times;</button>
    </div>
    <form id="edit-card-form" enctype="multipart/form-data">
        <div class="form-group">
            <label for="edit-card-title">Title <span class="required">*</span></label>
            <input type="text" id="edit-card-title" name="title" required maxlength="200" autocomplete="off">
        </div>
        <div class="form-group">
            <label for="edit-card-description">Description</label>
            <textarea id="edit-card-description" name="description" placeholder="Optional notes..."></textarea>
        </div>
        <div class="form-group">
            <label for="edit-card-image">Image <span class="hint">(jpg/png, max 1MB)</span></label>
            <div id="edit-current-image-wrap" style="display:none;margin-bottom:8px;">
                <img id="edit-current-image" src="" alt="" style="max-width:100%;max-height:120px;border-radius:3px;">
            </div>
            <input type="file" id="edit-card-image" name="image" accept=".jpg,.jpeg,.png">
        </div>
        <div class="form-group">
            <label>Pin Position</label>
            <div class="pin-position-group">
                <label><input type="radio" name="pin_position" value="left"> Left</label>
                <label><input type="radio" name="pin_position" value="center"> Center</label>
                <label><input type="radio" name="pin_position" value="right"> Right</label>
            </div>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn-danger" onclick="deleteEditingCard()">Delete</button>
            <button type="button" class="btn-secondary" onclick="closeEditPanel()">Cancel</button>
            <button type="submit" class="btn-primary">Save</button>
        </div>
    </form>
</div>

<!-- Note creation modal -->
<div id="note-modal-overlay">
    <div id="note-modal">
        <h2>New Note</h2>
        <form id="note-form">
            <div class="form-group">
                <label for="note-content">Text</label>
                <textarea id="note-content" name="content" placeholder="Write here..."></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeNoteModal()">Cancel</button>
                <button type="submit" class="btn-primary">Create Note</button>
            </div>
        </form>
    </div>
</div>

<!-- Card creation modal -->
<div id="modal-overlay">
    <div id="modal">
        <h2>New Card</h2>
        <form id="card-form" enctype="multipart/form-data">
            <div class="form-group">
                <label for="card-title">Title <span class="required">*</span></label>
                <input type="text" id="card-title" name="title" required maxlength="200" autocomplete="off">
            </div>
            <div class="form-group">
                <label for="card-description">Description</label>
                <textarea id="card-description" name="description" placeholder="Optional notes..."></textarea>
            </div>
            <div class="form-group">
                <label for="card-image">Image <span class="hint">(jpg/png, max 1MB)</span></label>
                <input type="file" id="card-image" name="image" accept=".jpg,.jpeg,.png">
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                <button type="submit" class="btn-primary">Create Card</button>
            </div>
        </form>
    </div>
</div>

<!-- Login modal -->
<div id="login-modal-overlay">
    <div id="login-modal">
        <h2>Log in</h2>
        <form id="login-form">
            <div class="form-group">
                <label for="login-email">Email</label>
                <input type="email" id="login-email" name="email" required autocomplete="email">
            </div>
            <div class="form-group">
                <label for="login-password">Password</label>
                <input type="password" id="login-password" name="password" required autocomplete="current-password">
            </div>
            <p id="login-error" class="auth-error"></p>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeLoginModal()">Cancel</button>
                <button type="submit" class="btn-primary">Log in</button>
            </div>
        </form>
        <p class="auth-switch">Don't have an account? <a href="#" onclick="closeLoginModal(); openRegisterModal(); return false;">Sign up</a></p>
    </div>
</div>

<!-- Register modal -->
<div id="register-modal-overlay">
    <div id="register-modal">
        <h2>Sign up</h2>
        <form id="register-form">
            <div class="form-group">
                <label for="register-email">Email</label>
                <input type="email" id="register-email" name="email" required autocomplete="email">
            </div>
            <div class="form-group">
                <label for="register-password">Password <span class="hint">(min 8 characters)</span></label>
                <input type="password" id="register-password" name="password" required minlength="8" autocomplete="new-password">
            </div>
            <p id="register-error" class="auth-error"></p>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeRegisterModal()">Cancel</button>
                <button type="submit" class="btn-primary">Sign up</button>
            </div>
        </form>
        <p class="auth-switch">Already have an account? <a href="#" onclick="closeRegisterModal(); openLoginModal(); return false;">Log in</a></p>
    </div>
</div>
{% endblock %}
