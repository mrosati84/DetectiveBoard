{% extends 'base.html' %}

{% block title %}DetectiveBoard{% endblock %}

{% block content %}
<!-- Cork board -->
<div id="board">
    <div id="canvas">
        <svg id="connections-svg" xmlns="http://www.w3.org/2000/svg"></svg>
    </div>
    <div id="no-board-msg">
        <p>Open the menu to load or create a board</p>
    </div>
</div>

<!-- Reset pan button (top-right, visible only when panned) -->
<button id="reset-pan-btn" onclick="resetPan()" title="Reset pan" style="display:none;">&#8982; Reset Pan</button>

<!-- Menu toggle -->
<button id="menu-toggle" onclick="toggleMenu()" title="Toggle boards menu">&#9776; Boards</button>

<!-- Left slide-in menu -->
<div id="menu">
    <h2>Boards</h2>
    <form id="new-board-form">
        <input type="text" id="new-board-name" placeholder="Board name..." maxlength="100" autocomplete="off">
        <button type="submit" id="create-board-btn" title="Create board">+</button>
    </form>
    <div id="boards-list"></div>
</div>

<!-- Bottom toolbar -->
<div id="toolbar">
    <button id="add-card-btn" class="toolbar-btn" onclick="openModal()">+ Add Card</button>
    <button id="connect-btn" class="toolbar-btn" onclick="connectCards()">&#128279; Connect</button>
    <button id="disconnect-btn" class="toolbar-btn" onclick="disconnectCards()">&#9986; Disconnect</button>
</div>

<!-- Card edit panel (right side) -->
<div id="edit-panel">
    <div id="edit-panel-header">
        <h2>Modifica Card</h2>
        <button id="edit-panel-close" onclick="closeEditPanel()" title="Chiudi">&times;</button>
    </div>
    <form id="edit-card-form" enctype="multipart/form-data">
        <div class="form-group">
            <label for="edit-card-title">Titolo <span class="required">*</span></label>
            <input type="text" id="edit-card-title" name="title" required maxlength="200" autocomplete="off">
        </div>
        <div class="form-group">
            <label for="edit-card-description">Descrizione</label>
            <textarea id="edit-card-description" name="description" placeholder="Note opzionali..."></textarea>
        </div>
        <div class="form-group">
            <label for="edit-card-image">Immagine <span class="hint">(jpg/png, max 1MB)</span></label>
            <div id="edit-current-image-wrap" style="display:none;margin-bottom:8px;">
                <img id="edit-current-image" src="" alt="" style="max-width:100%;max-height:120px;border-radius:3px;">
            </div>
            <input type="file" id="edit-card-image" name="image" accept=".jpg,.jpeg,.png">
        </div>
        <div class="form-group">
            <label>Posizione Pin</label>
            <div class="pin-position-group">
                <label><input type="radio" name="pin_position" value="left"> Sinistra</label>
                <label><input type="radio" name="pin_position" value="center"> Centro</label>
                <label><input type="radio" name="pin_position" value="right"> Destra</label>
            </div>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="closeEditPanel()">Annulla</button>
            <button type="submit" class="btn-primary">Salva</button>
        </div>
    </form>
</div>

<!-- Card creation modal -->
<div id="modal-overlay">
    <div id="modal">
        <h2>New Card</h2>
        <form id="card-form" enctype="multipart/form-data">
            <div class="form-group">
                <label for="card-title">Title <span class="required">*</span></label>
                <input type="text" id="card-title" name="title" required maxlength="200" autocomplete="off">
            </div>
            <div class="form-group">
                <label for="card-description">Description</label>
                <textarea id="card-description" name="description" placeholder="Optional notes..."></textarea>
            </div>
            <div class="form-group">
                <label for="card-image">Image <span class="hint">(jpg/png, max 1MB)</span></label>
                <input type="file" id="card-image" name="image" accept=".jpg,.jpeg,.png">
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeModal()">Cancel</button>
                <button type="submit" class="btn-primary">Create Card</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
